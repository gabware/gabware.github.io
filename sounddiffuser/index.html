<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Diffuser Configurator</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="icon.svg">
    <link rel="stylesheet" href="style.css">
    <!-- Import map for Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>Sound Diffuser Configurator</h1>
    </header>

    <nav id="mobile-tabs">
        <button class="tab-btn active" data-tab="preview">3D Preview</button>
        <button class="tab-btn" data-tab="config">Configuration</button>
    </nav>

    <main>
        <section id="preview-container" class="mobile-active">
            <!-- Three.js Canvas will be injected here -->
            <div id="three-canvas-wrapper"></div>
        </section>

        <section id="configuration-panel">
            <h2>Configuration</h2>
            
            <div class="control-group">
                <h3>Dimensions</h3>
                <div class="config-card">
                    <div class="config-card-grid grid-3">
                        <div><label>Width (in)</label><input type="number" id="overall-width" value="48" step="1"></div>
                        <div><label>Height (in)</label><input type="number" id="overall-height" value="36" step="1"></div>
                        <div><label>Block (in)</label><input type="number" id="block-size" value="1.5" step="0.25"></div>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>Block Configuration</h3>
                
                <label>Layout Type:
                    <select id="layout-type">
                        <option value="random" selected>Random Skyline</option>
                        <option value="wave">Wave</option>
                        <option value="ripple">Ripple</option>
                    </select>
                </label>

                <!-- Random Skyline Settings -->
                <div id="settings-random">
                    <div id="block-configs-container">
                        <!-- Dynamic block configs will be added here -->
                    </div>
                    <button id="add-block-config">+ Add Block Type</button>
                    <div class="layout-actions">
                        <button id="randomize-layout" class="primary">Generate</button>
                    </div>
                    <div id="validation-message" style="color: red; font-size: 0.8rem; margin-top: 0.5rem;"></div>
                </div>

                <!-- Wave Settings -->
                <div id="settings-wave" style="display: none;">
                    <div id="wave-layers-container"></div>
                    <button id="add-wave-layer">+ Add Wave Layer</button>
                    <div class="config-card">
                        <div class="config-card-grid grid-3">
                            <div><label>Min Depth</label><input type="number" id="wave-minDepth" value="1" step="0.25"></div>
                            <div><label>Max Depth</label><input type="number" id="wave-maxDepth" value="5" step="0.25"></div>
                            <div><label>Step</label><input type="number" id="wave-depthStep" value="1" step="0.125"></div>
                        </div>
                    </div>
                </div>

                <!-- Ripple Settings -->
                <div id="settings-ripple" style="display: none;">
                    <div id="ripple-layers-container"></div>
                    <button id="add-ripple-layer">+ Add Ripple Layer</button>
                    <div class="config-card">
                        <div class="config-card-grid grid-3">
                            <div><label>Min Depth</label><input type="number" id="ripple-minDepth" value="1" step="0.25"></div>
                            <div><label>Max Depth</label><input type="number" id="ripple-maxDepth" value="5" step="0.25"></div>
                            <div><label>Step</label><input type="number" id="ripple-depthStep" value="1" step="0.125"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>Appearance</h3>
                <label>Background Color:
                    <input type="color" id="bg-color-picker" value="#1a1a1a">
                </label>
                
                <label>Color Layout Type:
                    <select id="color-layout-type">
                        <option value="random" selected>Random</option>
                        <option value="wave">Wave</option>
                        <option value="ripple">Ripple</option>
                    </select>
                </label>

                <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0;">
                    <input type="checkbox" id="sync-color-layout" style="width: auto; margin: 0;"> Sync with Block Layout
                </label>

                <!-- Color Random Settings -->
                <div id="settings-color-random">
                    <div id="color-configs-container">
                        <!-- Dynamic color rows will be added here -->
                    </div>
                    <button id="add-color-config">+ Add Color Type</button>
                    <div id="color-validation-message" style="color: red; font-size: 0.8rem; margin-top: 0.5rem;"></div>
                </div>

                <!-- Color Wave Settings -->
                <div id="settings-color-wave" style="display: none;">
                    <div id="color-wave-layers-container"></div>
                    <button id="add-color-wave-layer">+ Add Color Wave</button>
                </div>

                <!-- Color Ripple Settings -->
                <div id="settings-color-ripple" style="display: none;">
                    <div id="color-ripple-layers-container"></div>
                    <button id="add-color-ripple-layer">+ Add Color Ripple</button>
                </div>
            </div>

            <div class="action-buttons">
                <button id="btn-export" class="primary">Export JSON</button>
                <button id="btn-load">Load JSON</button>
                <input type="file" id="input-load" accept=".json" style="display: none;">
                <button id="btn-undo">Undo (Ctrl+Z)</button>
                <button id="btn-ar" class="secondary">View in Your Space (AR)</button>
            </div>
        </section>
    </main>

    <script type="module" src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js');
            });
        }
    </script>
</body>
</html>
